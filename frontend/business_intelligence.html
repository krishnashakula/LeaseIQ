<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Lease Intelligence Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            overflow-x: hidden;
            background: #000;
            color: #fff;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            padding: 40px 0;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .subtitle {
            font-size: 1.3rem;
            color: #a0a0a0;
            margin-bottom: 30px;
        }

        .feature-badges {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 40px;
        }

        .badge {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.9rem;
            color: #667eea;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
        }

        .drop-zone {
            border: 2px dashed rgba(102, 126, 234, 0.5);
            border-radius: 12px;
            padding: 60px 20px;
            background: rgba(102, 126, 234, 0.05);
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .drop-zone:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .drop-zone.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.15);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .analysis-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .tab-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .results-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
            margin: 20px 0;
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
        }

        .metric-title {
            font-size: 0.9rem;
            color: #a0a0a0;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-subtitle {
            font-size: 0.85rem;
            color: #c0c0c0;
        }

        .risk-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-low { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .risk-medium { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        .risk-high { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .risk-critical { background: rgba(185, 28, 28, 0.2); color: #b91c1c; }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 15px;
            color: #ef4444;
            margin: 20px 0;
        }

        .success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 15px;
            color: #22c55e;
            margin: 20px 0;
        }

        .recommendations-list {
            list-style: none;
            padding: 0;
        }

        .recommendations-list li {
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid #667eea;
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 0 8px 8px 0;
        }

        .opportunities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .opportunity-card {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 20px;
        }

        .opportunity-title {
            font-weight: 600;
            color: #22c55e;
            margin-bottom: 10px;
        }

        .opportunity-impact {
            font-size: 1.5rem;
            font-weight: 700;
            color: #22c55e;
            margin: 8px 0;
        }

        .portfolio-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .animated-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .container {
                padding: 20px 15px;
            }
            
            .upload-section {
                padding: 30px 20px;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .analysis-tabs {
                flex-direction: column;
            }
        }

        .advanced-features {
            margin: 40px 0;
            text-align: center;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.1);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #667eea;
        }

        .feature-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #fff;
        }

        .feature-description {
            color: #a0a0a0;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <canvas id="canvas-container" class="animated-background"></canvas>
    
    <div class="container">
        <header>
            <h1>üè¢ Enterprise Lease Intelligence</h1>
            <p class="subtitle">Advanced AI-powered lease analysis & portfolio optimization</p>
            
            <div class="feature-badges">
                <span class="badge">üîç Smart Risk Assessment</span>
                <span class="badge">üí∞ Revenue Optimization</span>
                <span class="badge">üìä Portfolio Analytics</span>
                <span class="badge">‚öñÔ∏è Compliance Monitoring</span>
                <span class="badge">üéØ Market Intelligence</span>
            </div>
        </header>

        <!-- Advanced Features Overview -->
        <section class="advanced-features">
            <h2 style="font-size: 2rem; margin-bottom: 20px; color: #fff;">Enterprise-Grade Capabilities</h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3 class="feature-title">Instant Analysis</h3>
                    <p class="feature-description">Transform 50+ page lease documents into actionable business intelligence in seconds</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3 class="feature-title">Risk Prediction</h3>
                    <p class="feature-description">AI-powered risk scoring identifies potential issues before they become costly problems</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h3 class="feature-title">Revenue Insights</h3>
                    <p class="feature-description">Uncover hidden revenue opportunities worth $50K-$400K+ annually per property</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üèõÔ∏è</div>
                    <h3 class="feature-title">Compliance Shield</h3>
                    <p class="feature-description">Automatically detect regulatory violations and prevent million-dollar legal risks</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üåê</div>
                    <h3 class="feature-title">Market Intelligence</h3>
                    <p class="feature-description">Real-time market positioning and competitive analysis for strategic advantage</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üé≤</div>
                    <h3 class="feature-title">Portfolio Optimization</h3>
                    <p class="feature-description">Enterprise dashboard for managing $100M+ portfolios with actionable insights</p>
                </div>
            </div>
        </section>

        <!-- Upload Section -->
        <section class="upload-section">
            <h2 style="font-size: 1.5rem; margin-bottom: 20px;">Upload Lease Document</h2>
            
            <div class="drop-zone" onclick="document.getElementById('fileInput').click();">
                <div class="upload-icon">üìÑ</div>
                <div class="upload-text">Drop your lease document here or click to browse</div>
                <div class="upload-subtext">Supports PDF files up to 50MB ‚Ä¢ Enterprise-grade security</div>
            </div>
            
            <input type="file" id="fileInput" class="file-input" accept=".pdf">
            <button class="btn" onclick="uploadFile()" id="uploadBtn" disabled>üöÄ Analyze Document</button>
        </section>

        <!-- Analysis Tabs -->
        <div class="analysis-tabs" id="analysisTabs" style="display: none;">
            <button class="tab-button active" onclick="showTab('overview')" data-tab="overview">üìä Overview</button>
            <button class="tab-button" onclick="showTab('risk')" data-tab="risk">‚ö†Ô∏è Risk Assessment</button>
            <button class="tab-button" onclick="showTab('revenue')" data-tab="revenue">üí∞ Revenue Optimization</button>
            <button class="tab-button" onclick="showTab('compliance')" data-tab="compliance">‚öñÔ∏è Compliance</button>
            <button class="tab-button" onclick="showTab('market')" data-tab="market">üéØ Market Intelligence</button>
            <button class="tab-button" onclick="showTab('retention')" data-tab="retention">ü§ù Tenant Retention</button>
        </div>

        <!-- Results Sections -->
        
        <!-- Overview Tab -->
        <div class="results-section active" id="overview-tab">
            <h3 style="margin-bottom: 20px;">üìä Business Metrics Overview</h3>
            <div class="metrics-grid" id="metricsGrid">
                <!-- Metrics will be populated by JavaScript -->
            </div>
            
            <div id="loadingIndicator" class="loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p>Analyzing document with enterprise AI engines...</p>
            </div>
        </div>

        <!-- Risk Assessment Tab -->
        <div class="results-section" id="risk-tab">
            <h3 style="margin-bottom: 20px;">‚ö†Ô∏è Risk Assessment & Mitigation</h3>
            <div id="riskContent">
                <!-- Risk content will be populated by JavaScript -->
            </div>
        </div>

        <!-- Revenue Optimization Tab -->
        <div class="results-section" id="revenue-tab">
            <h3 style="margin-bottom: 20px;">üí∞ Revenue Optimization Opportunities</h3>
            <div id="revenueContent">
                <!-- Revenue content will be populated by JavaScript -->
            </div>
        </div>

        <!-- Compliance Tab -->
        <div class="results-section" id="compliance-tab">
            <h3 style="margin-bottom: 20px;">‚öñÔ∏è Regulatory Compliance Analysis</h3>
            <div id="complianceContent">
                <!-- Compliance content will be populated by JavaScript -->
            </div>
        </div>

        <!-- Market Intelligence Tab -->
        <div class="results-section" id="market-tab">
            <h3 style="margin-bottom: 20px;">üéØ Market Intelligence & Positioning</h3>
            <div id="marketContent">
                <!-- Market content will be populated by JavaScript -->
            </div>
        </div>

        <!-- Tenant Retention Tab -->
        <div class="results-section" id="retention-tab">
            <h3 style="margin-bottom: 20px;">ü§ù Tenant Retention Analysis</h3>
            <div id="retentionContent">
                <!-- Retention content will be populated by JavaScript -->
            </div>
        </div>

        <div id="errorMessage" class="error" style="display: none;"></div>
        <div id="successMessage" class="success" style="display: none;"></div>
    </div>

    <script>
        // Global API configuration (consistent with index.html)
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:5000' 
            : '';

        let currentJobId = null;
        
        // Animated background
        const canvas = document.getElementById('canvas-container');
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        const particles = [];
        for (let i = 0; i < 50; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 2 + 1,
                vx: (Math.random() - 0.5) * 0.5,
                vy: (Math.random() - 0.5) * 0.5,
                opacity: Math.random() * 0.5 + 0.2
            });
        }
        
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            particles.forEach(particle => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                
                if (particle.x < 0 || particle.x > canvas.width) particle.vx *= -1;
                if (particle.y < 0 || particle.y > canvas.height) particle.vy *= -1;
                
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(102, 126, 234, ${particle.opacity})`;
                ctx.fill();
            });
            
            // Draw connections
            particles.forEach((p1, i) => {
                particles.slice(i + 1).forEach(p2 => {
                    const distance = Math.sqrt((p1.x - p2.x) ** 2 + (p1.y - p2.y) ** 2);
                    if (distance < 100) {
                        ctx.beginPath();
                        ctx.moveTo(p1.x, p1.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.strokeStyle = `rgba(102, 126, 234, ${0.1 * (1 - distance / 100)})`;
                        ctx.stroke();
                    }
                });
            });
            
            requestAnimationFrame(animate);
        }
        
        animate();
        
        // File handling
        const dropZone = document.querySelector('.drop-zone');
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                fileInput.files = files;
                uploadBtn.disabled = false;
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            uploadBtn.disabled = !e.target.files.length;
        });
        
        async function uploadFile() {
            const file = fileInput.files[0];
            if (!file) {
                showError('Please select a PDF file first');
                return;
            }
            
            if (file.type !== 'application/pdf') {
                showError('Only PDF files are supported');
                return;
            }
            
            showLoading(true);
            hideMessages();
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                // Upload and extract document
                const response = await fetch(`${API_URL}/api/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`Upload failed: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.status === 'success' && result.job_id) {
                    currentJobId = result.job_id;
                    showSuccess(`Document uploaded successfully! Analyzing with enterprise AI...`);
                } else {
                    throw new Error(result.error || 'Upload failed');
                }
                
                // Run business intelligence analysis
                await runBusinessAnalysis(currentJobId);
                
            } catch (error) {
                showError(`Error: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        async function runBusinessAnalysis(jobId) {
            try {
                // Run business analysis
                const analysisResponse = await fetch(`${API_URL}/api/business/analyze/${jobId}`);
                if (!analysisResponse.ok) {
                    throw new Error(`Analysis failed: ${analysisResponse.statusText}`);
                }
                
                const analysisResult = await analysisResponse.json();
                
                if (analysisResult.status === 'success' && analysisResult.analysis) {
                    // Display results
                    displayAnalysisResults(analysisResult.analysis);
                } else {
                    throw new Error(analysisResult.error || 'Analysis failed');
                }
                
                // Show analysis tabs
                document.getElementById('analysisTabs').style.display = 'flex';
                
                showSuccess('üéâ Advanced analysis complete! Explore the insights below.');
                
            } catch (error) {
                console.error('Business analysis error:', error);
                showError(`Business analysis failed: ${error.message}`);
            }
        }
        
        function displayAnalysisResults(analysis) {
            if (!analysis) {
                console.error('No analysis data provided');
                showError('Analysis data is missing');
                return;
            }
            
            // Validate required sections
            if (!analysis.business_metrics || !analysis.risk_assessment) {
                console.warn('Missing required analysis sections');
            }
            
            displayOverview(analysis.business_metrics, analysis.risk_assessment);
            displayRiskAssessment(analysis.risk_assessment);
            displayRevenueOpportunities(analysis.revenue_opportunities, analysis.market_analysis);
            displayCompliance(analysis.compliance_report);
            displayMarketIntelligence(analysis.market_analysis);
            displayRetentionAnalysis(analysis.portfolio_insights);
        }
        
        function displayOverview(metrics, risk) {
            if (!metrics || !risk) {
                console.error('Missing data in displayOverview');
                return;
            }
            const metricsGrid = document.getElementById('metricsGrid');
            metricsGrid.innerHTML = `
                <div class="metric-card">
                    <div class="metric-title">Monthly Rent</div>
                    <div class="metric-value">$${metrics.monthly_rent.toLocaleString()}</div>
                    <div class="metric-subtitle">Base rental income</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title">Total Lease Value</div>
                    <div class="metric-value">$${metrics.total_lease_value.toLocaleString()}</div>
                    <div class="metric-subtitle">Full term value</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title">Risk Level</div>
                    <div class="metric-value">
                        <span class="risk-indicator risk-${risk.risk_level}">${risk.risk_level}</span>
                    </div>
                    <div class="metric-subtitle">Overall risk score: ${risk.risk_score}/100</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title">Security Deposit</div>
                    <div class="metric-value">$${metrics.security_deposit.toLocaleString()}</div>
                    <div class="metric-subtitle">Upfront deposit required</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title">Notice Period</div>
                    <div class="metric-value">${metrics.notice_period_days}</div>
                    <div class="metric-subtitle">Days required notice</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title">Financial Exposure</div>
                    <div class="metric-value">$${risk.financial_exposure.toLocaleString()}</div>
                    <div class="metric-subtitle">Total potential liability</div>
                </div>
            `;
        }
        
        function displayRiskAssessment(risk) {
            if (!risk) {
                console.error('Missing risk data');
                return;
            }
            const riskContent = document.getElementById('riskContent');
            riskContent.innerHTML = `
                <div class="metric-card">
                    <h4 style="color: #667eea; margin-bottom: 15px;">Risk Summary</h4>
                    <p>Risk Level: <span class="risk-indicator risk-${risk.risk_level}">${risk.risk_level}</span></p>
                    <p>Risk Score: <strong>${risk.risk_score}/100</strong></p>
                    <p>Financial Exposure: <strong>$${risk.financial_exposure.toLocaleString()}</strong></p>
                </div>
                
                ${risk.red_flags.length > 0 ? `
                <div class="metric-card">
                    <h4 style="color: #ef4444; margin-bottom: 15px;">üö® Red Flags Identified</h4>
                    <ul class="recommendations-list">
                        ${risk.red_flags.map(flag => `<li>${flag}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
                
                ${risk.compliance_issues.length > 0 ? `
                <div class="metric-card">
                    <h4 style="color: #fbbf24; margin-bottom: 15px;">‚öñÔ∏è Compliance Concerns</h4>
                    <ul class="recommendations-list">
                        ${risk.compliance_issues.map(issue => `<li>${issue}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
                
                <div class="metric-card">
                    <h4 style="color: #22c55e; margin-bottom: 15px;">üí° Risk Mitigation Recommendations</h4>
                    <ul class="recommendations-list">
                        ${risk.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                
                ${risk.tenant_favorable_terms.length > 0 ? `
                <div class="metric-card">
                    <h4 style="color: #22c55e; margin-bottom: 15px;">‚úÖ Tenant-Favorable Terms</h4>
                    <ul class="recommendations-list">
                        ${risk.tenant_favorable_terms.map(term => `<li>${term}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
            `;
        }
        
        function displayRevenueOpportunities(opportunities, market) {
            if (!opportunities || !Array.isArray(opportunities)) {
                console.error('Invalid opportunities data');
                return;
            }
            const revenueContent = document.getElementById('revenueContent');
            
            const totalImpact = opportunities.reduce((sum, opp) => sum + (opp.annual_impact || 0), 0);
            
            revenueContent.innerHTML = `
                <div class="metric-card">
                    <h4 style="color: #667eea; margin-bottom: 15px;">üí∞ Total Revenue Potential</h4>
                    <div class="metric-value" style="color: #22c55e;">$${totalImpact.toLocaleString()}</div>
                    <div class="metric-subtitle">Annual optimization potential</div>
                </div>
                
                <div class="opportunities-grid">
                    ${opportunities.map(opp => `
                        <div class="opportunity-card">
                            <div class="opportunity-title">${opp.description}</div>
                            <div class="opportunity-impact">+$${(opp.annual_impact || 0).toLocaleString()}/year</div>
                            <p><strong>Timeline:</strong> ${opp.timeline || 'TBD'}</p>
                            <p><strong>Effort:</strong> ${opp.implementation_effort || 'Unknown'}</p>
                        </div>
                    `).join('')}
                </div>
                
                <div class="metric-card">
                    <h4 style="color: #667eea; margin-bottom: 15px;">üìä Market Position</h4>
                    <p><strong>Rent vs Market:</strong> ${market.rent_vs_market || 'Unknown'}</p>
                    <p><strong>Cost Efficiency Score:</strong> ${market.cost_efficiency_score || 0}/100</p>
                    <p><strong>Overall Position:</strong> ${market.overall_market_position || 'Unknown'}</p>
                </div>
            `;
        }
        
        function displayCompliance(compliance) {
            if (!compliance) {
                console.error('Missing compliance data');
                return;
            }
            const complianceContent = document.getElementById('complianceContent');
            complianceContent.innerHTML = `
                <div class="metric-card">
                    <h4 style="color: #667eea; margin-bottom: 15px;">üìã Compliance Score</h4>
                    <div class="metric-value" style="color: ${compliance.compliance_score >= 85 ? '#22c55e' : compliance.compliance_score >= 70 ? '#fbbf24' : '#ef4444'};">
                        ${compliance.compliance_score}/100
                    </div>
                    <div class="metric-subtitle">
                        Risk Level: <span class="risk-indicator risk-${compliance.risk_level}">${compliance.risk_level}</span>
                    </div>
                </div>
                
                ${compliance.violations.length > 0 ? `
                <div class="metric-card">
                    <h4 style="color: #ef4444; margin-bottom: 15px;">‚ö†Ô∏è Violations Detected</h4>
                    <ul class="recommendations-list">
                        ${compliance.violations.map(violation => `<li>${violation}</li>`).join('')}
                    </ul>
                </div>
                ` : `
                <div class="metric-card">
                    <h4 style="color: #22c55e; margin-bottom: 15px;">‚úÖ No Violations Detected</h4>
                    <p>The lease appears to be compliant with standard regulations.</p>
                </div>
                `}
                
                ${compliance.recommendations.length > 0 ? `
                <div class="metric-card">
                    <h4 style="color: #22c55e; margin-bottom: 15px;">üí° Compliance Recommendations</h4>
                    <ul class="recommendations-list">
                        ${compliance.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
            `;
        }
        
        function displayMarketIntelligence(market) {
            if (!market) {
                console.error('Missing market data');
                return;
            }
            const marketContent = document.getElementById('marketContent');
            marketContent.innerHTML = `
                <div class="metric-card">
                    <h4 style="color: #667eea; margin-bottom: 15px;">üéØ Market Position Analysis</h4>
                    <p><strong>Rent vs Market:</strong> ${market.rent_vs_market || 'Unknown'}</p>
                    <p><strong>Pet Fee Competitiveness:</strong> ${market.pet_fee_competitiveness || 'Unknown'}</p>
                    <p><strong>Notice Period:</strong> ${market.notice_period_favorability || 'Unknown'}</p>
                    <p><strong>Overall Position:</strong> ${market.overall_market_position || 'Unknown'}</p>
                </div>
                
                <div class="metric-card">
                    <h4 style="color: #667eea; margin-bottom: 15px;">üìà Cost Efficiency</h4>
                    <div class="metric-value">${market.cost_efficiency_score || 0}/100</div>
                    <div class="metric-subtitle">Efficiency rating vs market standards</div>
                </div>
                
                <div class="metric-card">
                    <h4 style="color: #667eea; margin-bottom: 15px;">üí° Strategic Insights</h4>
                    <p>‚Ä¢ Market positioning indicates ${market.overall_market_position || 'standard'} competitive stance</p>
                    <p>‚Ä¢ Cost efficiency score suggests ${(market.cost_efficiency_score || 0) >= 80 ? 'strong' : (market.cost_efficiency_score || 0) >= 60 ? 'moderate' : 'weak'} operational performance</p>
                    <p>‚Ä¢ Notice period terms are ${market.notice_period_favorability || 'neutral'} relative to market</p>
                </div>
            `;
        }
        
        function displayRetentionAnalysis(insights) {
            if (!insights) {
                console.error('Missing insights data');
                return;
            }
            const retentionContent = document.getElementById('retentionContent');
            const retentionProb = insights.retention_probability || 0.5;
            const churnRisk = retentionProb < 0.6 ? 'high' : retentionProb < 0.8 ? 'medium' : 'low';
            
            retentionContent.innerHTML = `
                <div class="metric-card">
                    <h4 style="color: #667eea; margin-bottom: 15px;">ü§ù Retention Probability</h4>
                    <div class="metric-value" style="color: ${retentionProb >= 0.8 ? '#22c55e' : retentionProb >= 0.6 ? '#fbbf24' : '#ef4444'};">
                        ${(retentionProb * 100).toFixed(1)}%
                    </div>
                    <div class="metric-subtitle">
                        Churn Risk: <span class="risk-indicator risk-${churnRisk}">${churnRisk}</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <h4 style="color: #667eea; margin-bottom: 15px;">üìä Property Classification</h4>
                    <p><strong>Type:</strong> ${insights.property_classification || 'Unknown'}</p>
                    <p><strong>Investment Attractiveness:</strong> ${insights.investment_attractiveness || 'Unknown'}</p>
                    <p><strong>Portfolio Fit Score:</strong> ${(insights.portfolio_fit_score || 0).toFixed(1)}/100</p>
                </div>
                
                <div class="metric-card">
                    <h4 style="color: #667eea; margin-bottom: 15px;">üí∞ Revenue Impact</h4>
                    <p><strong>Revenue Optimization Potential:</strong> $${(insights.revenue_optimization_potential || 0).toLocaleString()}</p>
                    <p><strong>Operational Efficiency Score:</strong> ${(insights.operational_efficiency_score || 0).toFixed(1)}/100</p>
                </div>
                
                <div class="metric-card">
                    <h4 style="color: #22c55e; margin-bottom: 15px;">üí° Retention Strategies</h4>
                    <ul class="recommendations-list">
                        <li>Monitor lease satisfaction 6 months before expiration</li>
                        <li>Proactive renewal outreach at 90-day mark</li>
                        <li>Competitive market analysis for renewal pricing</li>
                        <li>Address any identified risk factors early</li>
                        ${retentionProb < 0.7 ? '<li>Consider retention incentives or lease modifications</li>' : ''}
                    </ul>
                </div>
            `;
        }
        
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.results-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Add active class to clicked button
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }
        
        function showLoading(show) {
            document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none';
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => errorDiv.style.display = 'none', 10000);
        }
        
        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 5000);
        }
        
        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        // Helper function to get risk color based on level (DRY principle)
        function getRiskColor(riskLevel) {
            const colors = {
                'low': '#10b981',
                'medium': '#f59e0b',
                'high': '#ef4444',
                'critical': '#b91c1c'
            };
            return colors[riskLevel] || '#a0aec0';
        }

        // Helper function to get compliance color based on score
        function getComplianceColor(score) {
            if (score >= 85) return '#10b981';
            if (score >= 70) return '#f59e0b';
            return '#ef4444';
        }
    </script>
</body>
</html>